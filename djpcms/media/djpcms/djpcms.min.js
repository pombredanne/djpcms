!function(a){"use strict";function b(b){var c=b.data;b.isDefaultPrevented()||(b.preventDefault(),a(this).ajaxSubmit(c))}function c(b){var c=b.target,d=a(c);if(!d.is(":submit,input:image")){var e=d.closest(":submit");if(0===e.length)return;c=e[0]}var f=this;if(f.clk=c,"image"==c.type)if(void 0!==b.offsetX)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if("function"==typeof a.fn.offset){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)}function d(){if(a.fn.ajaxSubmit.debug){var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}}var e={};e.fileapi=void 0!==a("<input type='file'/>").get(0).files,e.formdata=void 0!==window.FormData,a.fn.ajaxSubmit=function(b){function c(c){for(var d=new FormData,e=0;e<c.length;e++)d.append(c[e].name,c[e].value);if(b.extraData)for(var f in b.extraData)b.extraData.hasOwnProperty(f)&&d.append(f,b.extraData[f]);b.data=null;var g=a.extend(!0,{},a.ajaxSettings,b,{contentType:!1,processData:!1,cache:!1,type:"POST"});b.uploadProgress&&(g.xhr=function(){var a=jQuery.ajaxSettings.xhr();return a.upload&&(a.upload.onprogress=function(a){var c=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(c=Math.ceil(d/e*100)),b.uploadProgress(a,d,e,c)}),a}),g.data=null;var h=g.beforeSend;g.beforeSend=function(a,c){c.data=d,h&&h.call(c,a,b)},a.ajax(g)}function f(c){function e(a){var b=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;return b}function f(){function b(){try{var a=e(q).readyState;d("state = "+a),a&&"uninitialized"==a.toLowerCase()&&setTimeout(b,50)}catch(c){d("Server abort: ",c," (",c.name,")"),h(z),v&&clearTimeout(v),v=void 0}}var c=j.attr("target"),f=j.attr("action");w.setAttribute("target",o),g||w.setAttribute("method","POST"),f!=l.url&&w.setAttribute("action",l.url),l.skipEncodingOverride||g&&!/post/i.test(g)||j.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),l.timeout&&(v=setTimeout(function(){u=!0,h(y)},l.timeout));var i=[];try{if(l.extraData)for(var k in l.extraData)l.extraData.hasOwnProperty(k)&&i.push(a('<input type="hidden" name="'+k+'">').attr("value",l.extraData[k]).appendTo(w)[0]);l.iframeTarget||(p.appendTo("body"),q.attachEvent?q.attachEvent("onload",h):q.addEventListener("load",h,!1)),setTimeout(b,15),w.submit()}finally{w.setAttribute("action",f),c?w.setAttribute("target",c):j.removeAttr("target"),a(i).remove()}}function h(b){if(!r.aborted&&!E){try{D=e(q)}catch(c){d("cannot access response document: ",c),b=z}if(b===y&&r)return void r.abort("timeout");if(b==z&&r)return void r.abort("server abort");if(D&&D.location.href!=l.iframeSrc||u){q.detachEvent?q.detachEvent("onload",h):q.removeEventListener("load",h,!1);var f,g="success";try{if(u)throw"timeout";var i="xml"==l.dataType||D.XMLDocument||a.isXMLDoc(D);if(d("isXml="+i),!i&&window.opera&&(null===D.body||!D.body.innerHTML)&&--F)return d("requeing onLoad callback, DOM not available"),void setTimeout(h,250);var j=D.body?D.body:D.documentElement;r.responseText=j?j.innerHTML:null,r.responseXML=D.XMLDocument?D.XMLDocument:D,i&&(l.dataType="xml"),r.getResponseHeader=function(a){var b={"content-type":l.dataType};return b[a]},j&&(r.status=Number(j.getAttribute("status"))||r.status,r.statusText=j.getAttribute("statusText")||r.statusText);var k=(l.dataType||"").toLowerCase(),n=/(json|script|text)/.test(k);if(n||l.textarea){var o=D.getElementsByTagName("textarea")[0];if(o)r.responseText=o.value,r.status=Number(o.getAttribute("status"))||r.status,r.statusText=o.getAttribute("statusText")||r.statusText;else if(n){var s=D.getElementsByTagName("pre")[0],t=D.getElementsByTagName("body")[0];s?r.responseText=s.textContent?s.textContent:s.innerText:t&&(r.responseText=t.textContent?t.textContent:t.innerText)}}else"xml"==k&&!r.responseXML&&r.responseText&&(r.responseXML=G(r.responseText));try{C=I(r,k,l)}catch(b){g="parsererror",r.error=f=b||g}}catch(b){d("error caught: ",b),g="error",r.error=f=b||g}r.aborted&&(d("upload aborted"),g=null),r.status&&(g=r.status>=200&&r.status<300||304===r.status?"success":"error"),"success"===g?(l.success&&l.success.call(l.context,C,"success",r),m&&a.event.trigger("ajaxSuccess",[r,l])):g&&(void 0===f&&(f=r.statusText),l.error&&l.error.call(l.context,r,g,f),m&&a.event.trigger("ajaxError",[r,l,f])),m&&a.event.trigger("ajaxComplete",[r,l]),m&&!--a.active&&a.event.trigger("ajaxStop"),l.complete&&l.complete.call(l.context,r,g),E=!0,l.timeout&&clearTimeout(v),setTimeout(function(){l.iframeTarget||p.remove(),r.responseXML=null},100)}}}var i,k,l,m,o,p,q,r,s,t,u,v,w=j[0],x=!!a.fn.prop;if(a(":input[name=submit],:input[id=submit]",w).length)return void alert('Error: Form elements must not have name or id of "submit".');if(c)for(k=0;k<n.length;k++)i=a(n[k]),x?i.prop("disabled",!1):i.removeAttr("disabled");if(l=a.extend(!0,{},a.ajaxSettings,b),l.context=l.context||l,o="jqFormIO"+(new Date).getTime(),l.iframeTarget?(p=a(l.iframeTarget),t=p.attr("name"),t?o=t:p.attr("name",o)):(p=a('<iframe name="'+o+'" src="'+l.iframeSrc+'" />'),p.css({position:"absolute",top:"-1000px",left:"-1000px"})),q=p[0],r={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(b){var c="timeout"===b?"timeout":"aborted";d("aborting upload... "+c),this.aborted=1,p.attr("src",l.iframeSrc),r.error=c,l.error&&l.error.call(l.context,r,c,b),m&&a.event.trigger("ajaxError",[r,l,c]),l.complete&&l.complete.call(l.context,r,c)}},m=l.global,m&&0===a.active++&&a.event.trigger("ajaxStart"),m&&a.event.trigger("ajaxSend",[r,l]),l.beforeSend&&l.beforeSend.call(l.context,r,l)===!1)return void(l.global&&a.active--);if(!r.aborted){s=w.clk,s&&(t=s.name,t&&!s.disabled&&(l.extraData=l.extraData||{},l.extraData[t]=s.value,"image"==s.type&&(l.extraData[t+".x"]=w.clk_x,l.extraData[t+".y"]=w.clk_y)));var y=1,z=2,A=a("meta[name=csrf-token]").attr("content"),B=a("meta[name=csrf-param]").attr("content");B&&A&&(l.extraData=l.extraData||{},l.extraData[B]=A),l.forceSync?f():setTimeout(f,10);var C,D,E,F=50,G=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},H=a.parseJSON||function(a){return window.eval("("+a+")")},I=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f="xml"===c||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&"parsererror"===g.documentElement.nodeName&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),"string"==typeof g&&("json"===c||!c&&e.indexOf("json")>=0?g=H(g):("script"===c||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g}}}if(!this.length)return d("ajaxSubmit: skipping submit process - no element selected"),this;var g,h,i,j=this;"function"==typeof b&&(b={success:b}),g=this.attr("method"),h=this.attr("action"),i="string"==typeof h?a.trim(h):"",i=i||window.location.href||"",i&&(i=(i.match(/^([^#]+)/)||[])[1]),b=a.extend(!0,{url:i,success:a.ajaxSettings.success,type:g||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},b);var k={};if(this.trigger("form-pre-serialize",[this,b,k]),k.veto)return d("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(b.beforeSerialize&&b.beforeSerialize(this,b)===!1)return d("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var l=b.traditional;void 0===l&&(l=a.ajaxSettings.traditional);var m,n=[],o=this.formToArray(b.semantic,n);if(b.data&&(b.extraData=b.data,m=a.param(b.data,l)),b.beforeSubmit&&b.beforeSubmit(o,this,b)===!1)return d("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[o,this,b,k]),k.veto)return d("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var p=a.param(o,l);m&&(p=p?p+"&"+m:m),"GET"==b.type.toUpperCase()?(b.url+=(b.url.indexOf("?")>=0?"&":"?")+p,b.data=null):b.data=p;var q=[];if(b.resetForm&&q.push(function(){j.resetForm()}),b.clearForm&&q.push(function(){j.clearForm(b.includeHidden)}),!b.dataType&&b.target){var r=b.success||function(){};q.push(function(c){var d=b.replaceTarget?"replaceWith":"html";a(b.target)[d](c).each(r,arguments)})}else b.success&&q.push(b.success);b.success=function(a,c,d){for(var e=b.context||b,f=0,g=q.length;g>f;f++)q[f].apply(e,[a,c,d||j,j])};var s=a("input:file:enabled[value]",this),t=s.length>0,u="multipart/form-data",v=j.attr("enctype")==u||j.attr("encoding")==u,w=e.fileapi&&e.formdata;d("fileAPI :"+w);var x=(t||v)&&!w;b.iframe!==!1&&(b.iframe||x)?b.closeKeepAlive?a.get(b.closeKeepAlive,function(){f(o)}):f(o):(t||v)&&w?c(o):a.ajax(b);for(var y=0;y<n.length;y++)n[y]=null;return this.trigger("form-submit-notify",[this,b]),this},a.fn.ajaxForm=function(e){if(e=e||{},e.delegation=e.delegation&&a.isFunction(a.fn.on),!e.delegation&&0===this.length){var f={s:this.selector,c:this.context};return!a.isReady&&f.s?(d("DOM not ready, queuing ajaxForm"),a(function(){a(f.s,f.c).ajaxForm(e)}),this):(d("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return e.delegation?(a(document).off("submit.form-plugin",this.selector,b).off("click.form-plugin",this.selector,c).on("submit.form-plugin",this.selector,e,b).on("click.form-plugin",this.selector,e,c),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,b).bind("click.form-plugin",e,c)},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(b,c){var d=[];if(0===this.length)return d;var f=this[0],g=b?f.getElementsByTagName("*"):f.elements;if(!g)return d;var h,i,j,k,l,m,n;for(h=0,m=g.length;m>h;h++)if(l=g[h],j=l.name)if(b&&f.clk&&"image"==l.type)l.disabled||f.clk!=l||(d.push({name:j,value:a(l).val(),type:l.type}),d.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}));else if(k=a.fieldValue(l,!0),k&&k.constructor==Array)for(c&&c.push(l),i=0,n=k.length;n>i;i++)d.push({name:j,value:k[i]});else if(e.fileapi&&"file"==l.type&&!l.disabled){c&&c.push(l);var o=l.files;if(o.length)for(i=0;i<o.length;i++)d.push({name:j,value:o[i],type:l.type});else d.push({name:j,value:"",type:l.type})}else null!==k&&"undefined"!=typeof k&&(c&&c.push(l),d.push({name:j,value:k,type:l.type,required:l.required}));if(!b&&f.clk){var p=a(f.clk),q=p[0];j=q.name,j&&!q.disabled&&"image"==q.type&&(d.push({name:j,value:p.val()}),d.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}))}return d},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;g>f;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,value:e})}}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;e>d;d++){var f=this[d],g=a.fieldValue(f,b);null===g||"undefined"==typeof g||g.constructor==Array&&!g.length||(g.constructor==Array?a.merge(c,g):c.push(g))}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();if(void 0===c&&(c=!0),c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&-1==b.selectedIndex))return null;if("select"==f){var g=b.selectedIndex;if(0>g)return null;for(var h=[],i=b.options,j="select-one"==e,k=j?g+1:i.length,l=j?g:0;k>l;l++){var m=i[l];if(m.selected){var n=m.value;if(n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,e=this.tagName.toLowerCase();c.test(d)||"textarea"==e?this.value="":"checkbox"==d||"radio"==d?this.checked=!1:"select"==e?this.selectedIndex=-1:b&&(b===!0&&/hidden/.test(d)||"string"==typeof b&&a(this).is(b))&&(this.value="")})},a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return void 0===a&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return void 0===b&&(b=!0),this.each(function(){var c=this.type;if("checkbox"==c||"radio"==c)this.checked=b;else if("option"==this.tagName.toLowerCase()){var d=a(this).parent("select");b&&d[0]&&"select-one"==d[0].type&&d.find("option").selected(!1),this.selected=b}})},a.fn.ajaxSubmit.debug=!1}(jQuery),jQuery.cookie=function(a,b,c){if(arguments.length>1&&(null===b||"object"!=typeof b)){if(c=jQuery.extend({},c),null===b&&(c.expires=-1),"number"==typeof c.expires){var d=c.expires,e=c.expires=new Date;e.setDate(e.getDate()+d)}return document.cookie=[encodeURIComponent(a),"=",c.raw?String(b):encodeURIComponent(String(b)),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}c=b||{};var f,g=c.raw?function(a){return a}:decodeURIComponent;return(f=new RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?g(f[1]):null},exports={},function(a){"use strict";a.logging=function(){var b={},c={loggers:{},mapping:{},names:{},format_error:function(a,b){return void 0!==b&&(a+="- File "+b.fileName+" - Line "+b.lineNumber+": "+b),a},debug:10,info:20,warn:30,error:40,critical:50,logclass:"log"};return c.levels={debug:{level:c.debug,name:"DEBUG"},info:{level:c.info,name:"INFO"},warn:{level:c.warn,name:"WARN"},error:{level:c.error,name:"ERROR",f:function(a,b){return c.format_error(a,b)}},critical:{level:c.critical,name:"CRITICAL",f:function(a,b){return c.format_error(a,b)}}},a.each(c.levels,function(a,c){b[c.level]=c}),c.getLevelName=function(a){var c=b[a];return c=void 0!==c?c.name:"Level-"+a},c.default_formatter=function(a,b){var d=c.getLevelName(b),e=new Date,f=e.getHours(),g=e.getMinutes(),h=e.getSeconds();return 10>f&&(f="0"+f),10>g&&(g="0"+g),10>h&&(h="0"+h),f+":"+g+":"+h+" - "+d+" - "+a},c.html_formatter=function(a,b){var d=c.getLevelName(b);return a=c.default_formatter(a,b),'<pre class="'+c.logclass+" "+d.toLowerCase()+'">'+a+"</pre>"},c.getLogger=function(b){var d,e=10,f=[];return void 0===b&&(b="root"),d=c.loggers[b],void 0!==d?d:(d={name:b,level:function(){return e},set_level:function(a){e=parseInt(String(a),10)},addHandler:function(a){void 0!==a&&(void 0===a.formatter&&(a={formatter:c.default_formatter,log:a}),f.push(a))},log:function(b,c){e>c||a.each(f,function(a,d){d.log(d.formatter(b,c))})}},void 0!==console&&void 0!==console.log&&d.addHandler(function(a){console.log(a)}),a.each(c.levels,function(a,b){d[a]=function(a,c){b.f&&(a=b.f(a,c)),d.log(a,b.level)}}),c.loggers[d.name]=d,d)},c}(),a.djpcms={widgets:{},base_widget:{_create:function(){return this},factory:function(){return a.djpcms.widgets[this.name]},destroy:function(){var a,b=this.factory().instances,c=b.indexOf(this.id);return-1!==c&&(a=b[c],delete b[c],delete a.element[0].djpcms_widget),a},ui:function(b,c,d){return a.djpcms.ui[b](c,d)},tostring:function(a){return a=a?this.name+" "+this.id+" - "+a:this.name+" "+this.id},debug:function(b){a.djpcms.logger.debug(this.tostring(b))},info:function(b){a.djpcms.logger.info(this.tostring(b))},warn:function(b){a.djpcms.logger.warn(this.tostring(b))},error:function(b){a.djpcms.logger.error(this.tostring(b))},critical:function(b){a.djpcms.logger.critical(this.tostring(b))}},widgetmaker:{name:"widget",defaultElement:"<div>",selector:null,instance:function(a){return"number"!=typeof a&&(a=a.id),this.instances[a]},options:function(){return a.djpcms.options[this.name]},create:function(b,c){var d,e=this,f=b.data("options")||b.data();return d=a.extend({},e.factory),d.id=parseInt(e.instances.push(d),10)-1,d.element=b,b[0].djpcms_widget=d,f&&(c=a.extend(!0,{},c,f)),d.config=c,a.djpcms.logger.debug("Creating widget "+d.name),d._create(),e.instance(d.id)},make:function(b,c){var d,e=this,f=[];return c=a.extend(!0,{},e.options(),c),a.each(b,function(){d=e.create(a(this),c),void 0!==d&&f.push(d)}),1===f.length&&(f=f[0]),f},decorate:function(b){var c=this.selector;c&&(b.is(c)&&this.make(b),this.make(a(c,b)))},ui:function(b,c){var d=b;return void 0===c&&a.isPlainObject(b)&&(c=b,d=void 0),d=a(d||this.defaultElement),this.make(d,c)},create_ui:function(){var a=this;return function(b,c){return a.ui(b,c)}}},ui:{name:"djpcms",widget_head:"ui-widget-header",widget_body:"ui-widget-content",corner_top:"ui-corner-top",corner_bottom:"ui-corner-bottom",ui_input:"ui-input",dialog:function(b,c){var d,e=a.djpcms.ui,f=!0;return c=c||{},c.autoOpen===!1&&(f=!1),c.autoOpen=!1,d=b.dialog(c).dialog("widget"),"fontawesome"===e.icons&&a(".ui-dialog-titlebar-close",d).html('<i class="icon-remove"></i>').addClass(e.classes.float_right),f&&b.dialog("open"),b}}},a.djpcms=function(b){function c(c,d){var e=d||b.widgetmaker,f=e.factory||b.base_widget;return c.factory=a.extend({},f,c),c.superClass=d,c.instances=[],a.each(e,function(a,b){void 0===c[a]&&(c[a]=b)}),c}function d(d){var e=d.name||b.widgetmaker.name,f=b.widgets[e]||b.widgets[b.widgetmaker.name],g=d.config;d.name=e,void 0!==g&&delete d.config,v[e]&&(g=a.extend(!0,v[e],g)),v[e]=g,d=c(d,f),b.widgets[e]=d,b.ui[e]=d.create_ui()}function e(b){b=a(b),b.length&&u.addHandler({formatter:a.logging.html_formatter,log:function(a){b.prepend(a)}})}function f(b,c){var d={xhr:b};return c&&(d=a.extend(d,c)),d}function g(b){a.data(document,"djpcms")?b():t.push(b)}function h(b){a.extend(!0,v,b)}function i(a){q[a.id]=a}function j(a,b){var c=a.header,d=q[c];return d?d.handle(a.body,b,v):void u.error("Could not find callback "+c)}function k(a,b){var c=p[a];return c?b&&(c.action=b):(c={action:b,ids:{}},p[a]=c),c}function l(a,b){var c=k(a,null);c.ids[b]=b}function m(a,b){var c=k(a,null);return c.ids[b]?(delete c.ids[b],c.action):void 0}function n(a,b,c){var d=!1;return"success"===b&&(d=j(a,c)),r=!1,d}function o(b){return b.each(function(){var b=a(this),c=v,d=a(".djp-logging-panel",b),f=[];f.length||(this===document&&(b=a("body")),b.addClass("djpcms-loaded").trigger("djpcms-before-loading"),d&&e(d),a.each(a.djpcms.widgets,function(a,c){c.decorate(b)}),this===document&&(a.data(this,"djpcms",c),a.each(t,function(a,b){b()}),t=[]),b.trigger("djpcms-after-loading"))})}var p={},q={},r=!1,s=null,t=[],u=a.logging.getLogger(),v={media_url:"/media/",debug:!1,remove_effect:{type:"drop",duration:500},fadetime:200};return a.extend(b,{construct:o,options:v,jsonParse:j,addJsonCallBack:i,jsonCallBack:n,decorator:d,set_options:h,ajaxparams:f,set_inrequest:function(a){r=a},before_form_submit:[],addAction:k,registerActionElement:l,getAction:m,inrequest:function(){return r},logger:u,queue:g,panel:function(){return s||(s=a("<div>").hide().appendTo(a("body")).addClass("float-panel ui-widget ui-widget-content ui-corner-all").css({position:"absolute","text-align":"left",padding:"5px"})),s},smartwidth:function(a){return Math.max(15*Math.sqrt(a.length),200)}})}(a.djpcms),a.djpcms.decorator({config:{classes:{widget:"ui-widget",head:"ui-widget-header",body:"ui-widget-content",foot:"ui-widget-footer",active:"ui-state-active",clickable:"ui-clickable",float_right:"f-right"}}}),a.djpcms.confirmation_dialog=function(b,c,d,e){var f=a('<div title="'+b+'"></div>').html(String(c)),g=a.extend({},e,{modal:!0,draggable:!1,resizable:!1,buttons:{Ok:function(){a(this).dialog("close"),d(!0)},Cancel:function(){a(this).dialog("close"),d(!1)}},close:function(){f.dialog("destroy").remove()}});return a.djpcms.ui.dialog(f,g)},a.djpcms.warning_dialog=function(b,c,d){var e={dialogClass:"ui-state-error",autoOpen:!1},f=a.djpcms.confirmation_dialog(b,c,d,e);return a(".ui-dialog-titlebar, .ui-dialog-buttonpane",f.dialog("widget")).addClass("ui-state-error"),f.dialog("open"),f},a.djpcms.ajax_loader=function(b,c,d,e,f){var g=function(h){var i=this;f&&!h?a("<div></div>").html(f).dialog({modal:!0,draggable:!1,resizable:!1,buttons:{Ok:function(){a(this).dialog("close"),g(!0)},Cancel:function(){a(this).dialog("close"),a.djpcms.set_inrequest(!1)}}}):a.ajax({url:b,type:d||"post",dataType:"json",success:function(b,c){a.djpcms.set_inrequest(!1),a.djpcms.jsonCallBack(b,c,i)},data:a.djpcms.ajaxparams(c,e)})};return g},a.djpcms.ajax_loader_from_tool=function(b){return b.ajax?a.djpcms.ajax_loader(b.url,b.action,b.method,b.data,b.conf):void 0},a.djpcms.errorDialog=function(b,c){c=c||"Something did not work";var d=a('<div title="'+c+'"></div>').html(String(b)),e=a.djpcms.smartwidth(b);d.dialog({modal:!0,autoOpen:!1,dialogClass:"ui-state-error",width:e}),a(".ui-dialog-titlebar",d.dialog("widget")).addClass("ui-state-error"),d.dialog("open")},a.djpcms.addJsonCallBack({id:"error",handle:function(b){a.djpcms.errorDialog(b)}}),a.djpcms.addJsonCallBack({id:"servererror",handle:function(b){a.djpcms.errorDialog(b,"Unhandled Server Error")}}),a.djpcms.addJsonCallBack({id:"message",handle:function(b){return a.djpcms.logger.info(b),!0}}),a.djpcms.addJsonCallBack({id:"empty",handle:function(){return!0}}),a.djpcms.addJsonCallBack({id:"collection",handle:function(b,c){return a.each(b,function(b,d){a.djpcms.jsonParse(d,c)}),!0}}),a.djpcms.addJsonCallBack({id:"htmls",handle:function(b,c,d){return a.each(b,function(b,e){var f,g=a(e.identifier,c),h=d.fadetime;!g.length&&e.alldocument&&(g=a(e.identifier)),g.length&&("hide"===e.type?g.hide():"show"===e.type?g.show():"value"===e.type?g.val(e.html):"append"===e.type?a(e.html).djpcms().appendTo(g):(f=a(e.html).djpcms(),g.show(),g.fadeOut(h,"linear",function(){if("replacewith"===e.type)g.replaceWith(f);else if("addto"===e.type)g.append(f);else{var b=a("<div></div>");g.empty().append(b),b.replaceWith(f)}g.fadeIn(h)})))}),!0}}),a.djpcms.addJsonCallBack({id:"attribute",handle:function(b,c){a.each(b,function(b,d){var e;e=d.alldocument?a(d.selector):a(d.selector,c),e.length&&(d.elem=e)}),a.each(b,function(a,b){b.elem&&b.elem.attr(b.attr,b.value)})}}),a.djpcms.addJsonCallBack({id:"remove",handle:function(b,c){return a.each(b,function(b,d){var e=a(d.identifier,c),f=a.djpcms.options.remove_effect;!e.length&&d.alldocument&&(e=a(d.identifier)),e.length&&e.fadeIn(f.duration,function(){e.remove()})}),!0}}),a.djpcms.addJsonCallBack({id:"redirect",handle:function(a){window.location=a}}),a.djpcms.addJsonCallBack({id:"dialog",handle:function(b){var c=a("<div></div>").html(b.html).djpcms(),d={},e=b.options;return a.each(b.buttons,function(b,e){d[e.name]=function(){if(e.d=a(this),e.dialogcallBack=function(b){a.djpcms.jsonCallBack(b,"success",c),e.close&&e.d.dialog("close")},e.url){var b,d=a("form",c).formToArray();e.func&&(b=a.djpcms.ajaxparams(e.func),a.each(b,function(a,b){d.push({name:a,value:b})})),a.post(e.url,a.param(d),e.dialogcallBack,"json")}else e.d.dialog("close")}}),e.buttons=d,c.dialog(e),c}}),a.djpcms.format_currency=function(a,b){b||(b=3),a=a.replace(/, /g,"");var c,d,e,f,g,h,i,j,k=parseFloat(a),l=!1,m=!1,n="";if(isNaN(k))d=a;else{if(d=a.split(".",2),0>k&&(l=!0,k=Math.abs(k)),e=parseInt(k,10),2===d.length&&(n=d[1],n?(m=!0,n=k-e):n="."),m){for(i=Math.pow(10,b),j=String(parseInt(k*i,10)/i).split(".")[1],n="",m=!1,c=0;c<Math.min(j.length,b);c++)n+=j[c],parseInt(j[c],10)>0&&(m=!0);m&&(n="."+n)}for(e+="",h=e.length,d="",c=0;h>c;c++)d+=e[c],g=h-c-1,f=parseInt(g/3,10),3*f===g&&g>0&&(d+=",");d+=n,d=l?"-"+d:String(d)}return{value:d,negative:l}},a.djpcms.decorator({name:"ajax",description:"add ajax functionality to links, buttons, selects and forms",defaultElement:"<a>",selector:"a.ajax, button.ajax, select.ajax, form.ajax, input.ajax",config:{dataType:"json",classes:{submit:"submitted",autoload:"autoload"},confirm_actions:{"delete":"Please confirm delete",flush:"Please confirm flush"},effect:{name:"fade",options:{},speed:50},form:{iframe:!1,beforeSerialize:function(){return!0},beforeSubmit:function(b,c){var d=c[0].djpcms_widget,e=!d.disabled;return e&&(d.disabled=!0,a.each(a.djpcms.before_form_submit,function(){b=this(b,c)}),c.addClass(d.config.classes.submit)),e},success:function(a,b,c,d){var e=d[0].djpcms_widget;return e.finished(a,b,c)},error:function(a,b,c,d){var e=d[0].djpcms_widget;return e.finished(a,b,c)}},timeout:30},_create:function(){var a=this,b=a.element;a.disabled=!1,b.is("select")?(a.type="select",a.create_select()):b.is("input")?(a.type="input",a.create_select()):b.is("form")?(a.type="form",a.create_form()):(a.type="link",a.create_link())},finished:function(b,c){var d=this,e=d.element,f=d.config.effect,g=a(".form-messages, .error",e),h=0;e.removeClass(d.config.classes.submit),d.disabled=!1,g.hide(f.name,f.options,f.speed,function(){h+=1,a(this).html("").show(),h===g.length&&a.djpcms.jsonCallBack(b,c,e)})},form_data:function(){var a=this.element,b=a.closest("form"),c={conf:a.data("warning"),name:a.attr("name"),url:a.attr("href")||a.data("href"),type:a.data("method")||"get",submit:a.data("submit")};return 1===b.length&&(c.form=b),!c.url&&c.form&&(c.url=c.form.attr("action")),c.url||(c.url=window.location.toString()),c},submit:function(b){function c(c){if(c){var e=a.djpcms.ajaxparams(b.name,b.submit),f={url:b.url,type:b.type,dataType:d.config.dataType,data:e};d.info("Submitting ajax "+f.type+' request "'+b.name+'"'),b.form?(a.extend(f,d.config.form),b.form.ajaxSubmit(f)):(f.data.value=d.element.val(),f.success=a.djpcms.jsonCallBack,a.ajax(f))}}var d=this;b.conf?a.djpcms.warning_dialog(b.conf.title||"",b.conf.body||b.conf,c):c(!0)},create_select:function(){var a=this,b=a.form_data();a.element.change(function(){a.submit(b)})},create_link:function(){var a=this,b=a.form_data();a.element.click(function(c){c.preventDefault(),a.submit(b)})},create_form:function(){var b,c=this,d=c.element,e={url:d.attr("action"),type:d.attr("method"),dataType:c.config.dataType};a.extend(e,c.config.form),d.ajaxForm(e),d.hasClass(c.config.classes.autoload)&&(b=d.attr("name"),d[0].clk=a(":submit[name='"+b+"']",d)[0],d.submit())}}),a.djpcms.decorator({name:"autocomplete",defaultElement:"<input>",selector:"input.autocomplete",config:{classes:{autocomplete:"autocomplete",list:"multiSelectList",container:"multiSelectContainer"},removelink:function(){return a('<a href="#"><i class="icon-remove"></i></a>')},minLength:2,maxRows:50,search_string:"q",separator:", ",multiple:!1},split:function(a){return a.split(/,\s*/)},add_data:function(a){var b=this;return b.config.multiple?b.addOption(a):(b.real.val(a.real_value),b.element.val(a.value)),!1},get_autocomplete_data:function(){var a=this.element.val();this.multiple||this.real.data("value")!==a&&this.real.val(a)},addOption:function(b){var c=this,d=c.list,e=d.data("selections"),f=c.config,g=a("<li>"),h=a("<option>",{text:b.label,val:b.real_value}),i=h.val();-1===e.indexOf(i)&&(c.real.append(h),e.push(i),g.append(a("<span>",{html:b.label})).append(f.removelink(c)).data("option",h).appendTo(c.list),c.list.children().length&&c.list_container.show(),h.prop("selected",!0),c.element.val(""))},dropListItem:function(a){var b,c=a.data("option"),d=this.list.data("selections");a.remove(),0===this.list.children().length&&this.list_container.hide(),b=d.indexOf(c.val()),-1!==b&&d.splice(b,1),c.remove()},buildDom:function(){var b=this,c=b.config,d=a.djpcms.options.input.classes,e=a("<div>",{"class":c.classes.container}),f=b.list;b.wrapper&&(b.wrapper.after(e),e.addClass(d.control).prepend(b.wrapper.removeClass(d.control)),f=a("<div>",{"class":d.input}).addClass(c.classes.container).append(b.list)),b.list_container=f.hide(),e.append(b.list_container)},_create:function(){var b=this,c=b.config,d=this.element,e=d.attr("name"),f=e.length;if(c.select=function(a,c){return b.add_data(c.item)},b.wrapper=d.parent("."+a.djpcms.options.input.classes.input),b.wrapper.length||(b.wrapper=null),c.position={of:b.wrapper||d},c.multiple?("[]"===e.substring(f-2,f)&&(e=e.substring(0,f-2)),b.real=a('<select name="'+e+'[]" multiple="multiple"></select>'),b.list=a("<ul>").data("selections",[]).addClass(c.classes.list),b.buildDom(),b.list.delegate("a","click",function(c){return c.preventDefault(),b.dropListItem(a(this).closest("li")),!1}),c.focus=function(){return!1},d.bind("keydown",function(b){b.keyCode===a.ui.keyCode.TAB&&a(this).data("autocomplete").menu.active&&b.preventDefault()})):b.real=a('<input name="'+e+'"></input>'),d.attr("name",e+"_proxy").before(b.real.hide()),c.initials_value&&a.each(c.initials_value,function(a,c){b.add_data({real_value:c[0],value:c[1]})}),c.choices&&c.choices.length){var g=[];a.each(c.choices,function(a,b){g[a]={value:b[0],label:b[1]}}),c.source=function(){if(c.multiple)throw"Not implemented";return g},d.autocomplete(c)}else c.url?(c.source=function(b,d){var e,f={style:"full",maxRows:c.maxRows,search_string:c.search_string};f[c.search_string]=b.term,e=a.djpcms.ajax_loader(c.url,"autocomplete","get",f),a.proxy(e,d)()},d.autocomplete(c)):b.warn("Could not find choices or url for autocomplete data")}}),a.djpcms.addJsonCallBack({id:"autocomplete",handle:function(b,c){c(a.map(b,function(a){return{value:a[0],label:a[1],real_value:a[2]}}))}}),a.djpcms.decorator({name:"readonly",defaultElement:"<select>",selector:"select.readonly",_create:function(){var b=this.element,c=a(":selected",b);b.change(function(){b.children().prop("selected",!1),c.prop("selected",!0)})}}),a.djpcms.decorator({name:"input",defaultElement:'<input type="text">',selector:".ui-input",config:{submit:!1,classes:{input:"ui-input",control:"control",focus:"focus"}},_create:function(){var b,c=this,d=c.element,e=c.config;d.is("input")||d.is("textarea")?(d.removeClass(e.classes.input),c.wrapper=a("<div></div>").addClass(e.classes.input),b=d.prev(),b.length?b.after(c.wrapper):(b=d.parent(),b.length&&b.prepend(c.wrapper)),c.wrapper.append(d).addClass(d.attr("name"))):(c.wrapper=d,d=c.wrapper.children("input,textarea"),1===d.length&&(a.extend(!0,e,d.data("options")),c.element=d)),c.element.focus(function(){c.wrapper.addClass(e.classes.focus)}).blur(function(){c.wrapper.removeClass(e.classes.focus)}),e.submit&&c.element.keypress(function(a){if(13===a.which){var b=d.closest("form");b.length&&b.submit()}})}}),a.djpcms.decorator({name:"icon",defaultElement:"i",sources:{fontawesome:function(a,b){b?"icon-"!==b.substring(0,5)&&(b="icon-"+b):b="icon-question-sign",a.element.prepend('<i class="'+b+'"></i>')}},config:{source:"fontawesome"},_create:function(){var b=this.config,c=this.sources[b.source],d=b.icon;c&&(a.isPlainObject(d)&&(d=d[b.source]),c(this,d))}}),a.djpcms.decorator({name:"button",defaultElement:"<button>",description:"Add button like functionalities to html objects. It can handle anchors, buttons, inputs and checkboxes",selector:".btn",config:{disabled:null,text:!0,icon:null,classes:{button:"btn",button_small:"btn-small",button_large:"btn-large",button_group:"btn-group"}},_create:function(){var a,b,c,d,e,f=this,g=f.element.hide(),h=f.config,i=h.classes;f.type=g.is("[type=checkbox]")?"checkbox":g.is("[type=radio]")?"radio":g.is("input")?"input":"button","checkbox"===f.type||"radio"===f.type?(d=!0,b="label[for='"+g.attr("id")+"']",c=g.parents().last(),a=c.find(b),a&&(g.removeClass(i.button),a.attr("title",a.html()))):a=g,a?(f.buttonElement=a,e=a.children(),h.text?h.text!==!0&&a.html(h.text):a.html(""),h.icon&&f.ui("icon",a,{icon:h.icon}),a.addClass(i.button).css("display","inline-block"),d&&(f.refresh(),g.bind("change",function(){f.refresh()}))):f.destroy()},refresh:function(){var b=this,c=a.djpcms.options.widget.classes;b.element.prop("checked")?(a.djpcms.logger.debug("checked"),b.buttonElement.addClass(c.active)):(a.djpcms.logger.debug("unchecked"),b.buttonElement.removeClass(c.active))}}),a.djpcms.decorator({name:"alert",selector:".alert",config:{dismiss:!0,icon:{fontawesome:"remove"},effect:{name:"fade",options:{},speed:400},"float":"right"},_create:function(){var b=this,c=b.config,d=c.effect,e=a("<a href='#'>").css({"float":c.float}).click(function(c){c.preventDefault(),b.element.hide(d.name,d.options,d.speed,function(){a(this).remove()
})});a.djpcms.ui.icon(e,c),b.element.append(e)}}),a.djpcms.decorator({name:"collapsable",description:"Decorate box elements",selector:"a.collapse",config:{classes:{collapsable:"bd"},effect:{type:"blind",options:{},duration:10},icons:{open:{fontawesome:"plus-sign"},close:{fontawesome:"minus-sign"}}},_create:function(){var b=this,c=a.djpcms.options.widget.classes;b.widget=b.element.closest("."+c.widget),b.body=b.widget.find("."+b.config.classes.collapsable).first(),b.body.length&&(b.toggle(),b.element.mousedown(function(a){a.stopPropagation()}).click(function(){return b.widget.toggleClass("collapsed"),b.toggle(),!1}))},toggle:function(){var b=this,c=b.config.effect,d=b.config.icons,e=b.element.html("");b.widget.hasClass("collapsed")?(b.body.hide(c.type,c.options,c.duration,function(){a.djpcms.ui.icon(e,{icon:d.open})}),b.info("closed body")):(b.body.show(c.type,c.options,c.duration,function(){a.djpcms.ui.icon(e,{icon:d.close})}),b.info("opened body"))}}),a.djpcms.decorator({name:"autocomplete_off",decorate:function(b){a(".autocomplete-off",b).each(function(){a(this).attr("autocomplete","off")}),a("input:password",b).each(function(){a(this).attr("autocomplete","off")})}}),a.djpcms.decorator({name:"datepicker",selector:"input.dateinput",config:{dateFormat:"d M yy"},_create:function(){this.element.datepicker(this.config)}}),a.djpcms.decorator({name:"numeric",selector:"input.numeric",config:{classes:{negative:"negative"}},format:function(){var b=this.element,c=this.config.classes.negative,d=a.djpcms.format_currency(b.val());d.negative?b.addClass(c):b.removeClass(c),b.val(d.value)},_create:function(){var a=this;this.element.keyup(function(){a.format()})}}),a.djpcms.decorator({name:"showdown",selector:".markdown",_create:function(){var a,b=this.config.markdown;b&&Showdown&&(a=new Showdown.converter,b=a.makeHtml(b)),this.element.html(b)}}),a.fn.commonAncestor=function(){if(!this.length)return a([]);var b,c,d,e,f=[],g=1/0;for(this.each(function(){var b=a(this).parents();f.push(b),g=Math.min(g,b.length)}),a.each(f,function(a,b){f[a]=b.slice(b.length-g)}),b=0;b<f[0].length;b++){for(d=f[0][b],e=!0,c=1;c<f.length;c++)if(f[c][b]!==d){e=!1;break}if(e)return a(d)}return a([])},a.fn.extend({djpcms:function(){return a.djpcms.construct(this)}})}(jQuery);