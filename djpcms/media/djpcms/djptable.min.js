!function(a){"use strict";a.djpcms.decorator({name:"color_number",selector:"tr .color",config:{classes:{negative:"ui-state-error-text",arrow:"arrow"},icons:{up:{fontawesome:"icon-arrow-up",jquery:"ui-icon-arrowthick-1-n"},down:{fontawesome:"icon-arrow-down",jquery:"ui-icon-arrowthick-1-s"}}},_create:function(){var a=this.element,b=this.config,c=b.classes,d=a.html();try{d=parseFloat(d),0>d&&a.addClass(c.negative),a.hasClass(c.arrow)&&(d>0?this.ui("icon",a,{icon:b.icons.up}):0>d&&this.ui("icon",a,{icon:b.icons.up}))}catch(e){}}}),a.fn.dataTable&&(a.djpcms.datatable={fnRowCallbacks:[function(b){a(b).djpcms()}],fnRowCallback:function(b,c){return parseFloat(c[4])<=0&&a("td:eq(4)",b).addClass("redText"),b},fnDrawCallbacks:[]},a.fn.dataTableExt.oApi.fnSetFilteringDelay=function(b,c){var d=this;return c="undefined"==typeof c?250:c,this.each(function(b){function e(e){var f,g=e.data("sPreviousSearch");f=e.is("input")?e[0].value:e.val(),(void 0===g||g!==f)&&(window.clearTimeout(e.data("oTimerId")),e.data("sPreviousSearch",f),e.data("oTimerId",window.setTimeout(function(){a.fn.dataTableExt.iApiIndex=b,d.fnFilter(e.val(),e.data("column"))},c)))}a.fn.dataTableExt.iApiIndex=b;var f=a(this),g=f.closest("div.data-table"),h=d.fnSettings().aanFeatures.f,i=(a("input",h).addClass("input-filter"),a(".input-filter",g));return i.unbind("keyup").bind("keyup",function(){e(a(this))}),this}),this},a.djpcms.datatable.add_select_rows=function(b,c,d){function e(c,d){a.djpcms.jsonCallBack(c,d,b)}function f(b){b.each(function(){var b=a(this),c=b.parents("tr");b.is(":checked")?c.addClass("ui-state-highlight"):c.removeClass("ui-state-highlight")})}var g=d.url||".",h=a("select",c);b.delegate(".action-check input","click",function(){f(a(this))}),h.change(function(){if(this.value){var b=[],c=a.djpcms.ajaxparams(this.value,{ids:b});a(".action-check input:checked",this.table).each(function(){b.push(this.value)}),a.post(g,c,e,"json")}}),a(".select_all",c).click(function(){f(a(".action-check input").prop({checked:!0}))}),a(".select_none",c).click(function(){f(a(".action-check input").prop({checked:!1}))})},a.djpcms.datatable.addViews=function(b,c){function d(b){return function(c){if(c){var d=g[c],e=b.fnSettings();d&&(a.each(e.aoColumns,function(a,c){-1!==d.indexOf(c.sName)?b.fnSetColumnVis(a,!0,!1):b.fnSetColumnVis(a,!1,!1)}),ColVis.fnRebuild(b),a.each(a.djpcms.datatable.fnDrawCallbacks,function(a,c){c(b)}))}}}var e=a("div.col-selector"),f=a("<select></select>"),g={},h=0,i=!1;a.each(c,function(){var b,c=this.cols;c&&(h+=1,b=a("<option value='"+this.name+"'>"+this.display+"</option>"),this.initial&&!i&&(i=this.name,b.attr("selected","selected")),f.append(b),g[this.name]=c)}),h&&(e.html("<span class='selectors'>Select a view</span>").append(f),f[0].change_view=d(b),i&&f[0].change_view(i),f.change(function(){this.change_view(this.value)}))},a.djpcms.decorator({name:"datatable",selector:"div.data-table",config:{bDeferRender:!0,aaSorting:[],sPaginationType:"full_numbers",sDom:'<"H"<"row-selector"><"col-selector">T<"clear">ilrp>t<"F"ip>',oTableTools:{aButtons:["copy",{sExtends:"collection",sButtonText:"Save",aButtons:["csv","xls","pdf"]}]},fnRowCallback:function(b,c,d,e){return a.each(a.djpcms.datatable.fnRowCallbacks,function(a,f){f(b,c,d,e)}),b},fnDrawCallback:function(){var b=this;a.each(a.djpcms.datatable.fnDrawCallbacks,function(a,c){c(b)})}},to_obj:function(b){var c={};return a.each(b,function(){c[this.name]=this.value}),c},fnServerData:function(b,c,d,e){var f,g,h,i=this.to_obj(c),j=i.iSortingCols,k=i.sColumns.split(","),l=e.oInstance,m={},n={},o=window.location.search;for(f=0;j>f;f++)g=i["iSortCol_"+f],m[k[g]]=i["sSortDir_"+f];j?(h=o.slice(o.indexOf("?")+1).split("&"),m=a.param(a.extend(m,n)),window.location.replace(window.location.pathname+"?"+m)):this.updateDraw(e,l.data("datasize"))},ajaxServerData:function(b,c,d){a.ajax({dataType:"json",type:"POST",url:b,data:c,success:d})},_create:function(){function b(a){return function(){window.location.replace(a)}}var c,d,e,f=this,g=this.element,h=a.extend({},this.config),i=[],j=a("table",g).addClass("main display"),k=h.aoColumns;if(1===j.length){h.fnServerData=h.sAjaxSource?a.proxy(f.ajaxServerData,f):a.proxy(f.fnServerData,f),h.oTableTools.sSwfPath=a.djpcms.options.media_url+"djpcms/datatables/TableTools/swf/copy_cvs_xls_pdf.swf",g.data("tools")&&a.each(g.data("tools"),function(){var c={sExtends:"text",sButtonText:this.display,sToolTip:this.title,fnClick:function(a,b){b.send()}};i.push(c),c.send=this.ajax?a.djpcms.ajax_loader_from_tool(this):b(this.url)}),h.oTableTools.aButtons=i,h.filters&&f.filters(j,k);var l=j.dataTable(h);l.fnSetFilteringDelay(1e3),h.filters&&f.initialize_filters(l),g.data("actions")&&(c=g.data("actions"),d=a("div.row-selector",g).html("<span class='selectors'>Select: <a class='select_all' href='#'>All</a>, <a class='select_none' href='#'>None</a></span>"),e=a("<select><option value=''>Actions</option></select>").appendTo(d),a.each(c.choices,function(){e.append("<option value='"+this[0]+"'>"+this[1]+"</option>")}),a.djpcms.datatable.add_select_rows(j,d,c)),g.data("groups")&&a.djpcms.datatable.addViews(j,g.data("groups")),a(".dataTables_filter input").addClass("ui-widget-content"),j.width("100%"),g.show(),g.trigger("datatable-ready")}},filters:function(b,c){function d(b,c,d,e){var f=a(document.createElement("input")).attr({type:c,name:d,placeholder:e}).data("column",b.data("column"));b.append(f)}var e=a(document.createElement("tr")).addClass("filters"),f=!1;a.valHooks.th={get:function(b){var c=a(b),d={};return c.hasClass("input-filter")?(a.each(a("input",c),function(){var b=a(this),c=b.val();c&&(d[b.attr("name")]=c)}),a.param(d)):void 0},set:function(b,c){var d,e=a(b);e.hasClass("input-filter")&&(d={},c&&a.each(c.split("&"),function(){var a=this.split("=");2===a.length&&(d[a[0]]=a[1])}),a.each(a("input",e),function(){var b=a(this);b.val(d[b.attr("name")])}))}},c&&(a.each(c,function(b,c){var g,h=a(document.createElement("th")).addClass("input-filter").addClass(c.sName).data("column",b).appendTo(e),i=c.sFilter?c.sFilter.split("-"):[],j=i.length?i[0]:null;"range"===j?(d(h,"text","ge","from"),d(h,"text","le","to")):"input"===j&&d(h,"text","contains","search"),g=h.children("input"),g.length&&(f=!0,"date"===i[1]&&g.datepicker())}),f&&b.find("thead").prepend(e))},initialize_filters:function(b){var c=b.fnSettings();a.each(b,function(b){var d=a(this);a.fn.dataTableExt.iApiIndex=b,a.each(d.find("th.input-filter"),function(){var b=a(this),d=b.data("column"),e=c.aoPreSearchCols[d],f=e?e.sSearch:"";b.val(f)})})}}))}(jQuery);